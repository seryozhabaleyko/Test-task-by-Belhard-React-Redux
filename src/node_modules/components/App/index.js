import React, { Suspense, lazy, useEffect } from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';
import { connect } from 'react-redux';

import store from 'redux/store';
import PrivateRoute from 'routs/PrivateRoute';
import Topbar from 'components/Topbar';
import getProfileFetch from 'redux/actions/profile';

const Home = lazy(() => import('pages/Home'));
const Login = lazy(() => import('pages/Login'));
const News = lazy(() => import('pages/News'));
const Profile = lazy(() => import('pages/Profile'));

function App({ getProfileFetch }) {

    useEffect(() => {
        getProfileFetch();
    }, [getProfileFetch]);

    return (
        <Router>
            <div>
                <Topbar />
                <Suspense fallback={<div className="preloader">Загрузка...</div>}>
                    <Switch>
                        <Route path="/" component={Home} exact />
                        <Route path="/login" component={Login} />
                        <Route path="/news" component={News} />
                        <PrivateRoute store={store} path='/profile' component={Profile} />
                    </Switch>
                </Suspense>
            </div>
        </Router>
    );
}

const mapDispatchtoProps = (dispatch) => ({
    getProfileFetch: () => dispatch(getProfileFetch()),
});

export default connect(null, mapDispatchtoProps)(App);